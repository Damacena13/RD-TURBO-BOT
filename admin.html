<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>CENTRAL MASTER - GESTÃO TOTAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-[#0b1120] text-white p-4 font-sans text-xs sm:text-sm">
    <div class="max-w-6xl mx-auto bg-slate-800 p-4 sm:p-8 rounded-[30px] border-2 border-yellow-500 shadow-2xl">
        <h1 class="text-xl sm:text-3xl font-black text-yellow-500 mb-6 italic uppercase text-center">Gestão de Assinaturas & Sinais</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-slate-900 p-5 rounded-2xl border border-gray-700">
                <h2 class="text-yellow-500 font-bold mb-4 uppercase">Configurações de Sinais</h2>
                <label class="text-[10px] text-gray-400">LINK DO ROBÔ (WEB):</label>
                <input type="text" id="link_robo" class="w-full p-3 bg-slate-800 rounded-lg mb-4 border border-gray-600 outline-none">
                
                <label class="text-[10px] text-gray-400">TELEGRAM TOKEN:</label>
                <input type="text" id="tg_token" placeholder="Bot Token do BotFather" class="w-full p-3 bg-slate-800 rounded-lg mb-4 border border-gray-600">
                
                <label class="text-[10px] text-gray-400">ID DO GRUPO (CHAT ID):</label>
                <input type="text" id="tg_chat_id" placeholder="-100..." class="w-full p-3 bg-slate-800 rounded-lg mb-6 border border-gray-600">
                
                <button onclick="salvarConfig()" class="w-full bg-yellow-500 text-black font-black py-4 rounded-xl hover:bg-yellow-400 transition uppercase">Salvar Configurações</button>
            </div>

            <div class="bg-slate-900 p-5 rounded-2xl border border-gray-700">
                <h2 class="text-yellow-500 font-bold mb-4 uppercase">Clientes Cadastrados</h2>
                <div id="lista-clientes" class="space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
                    Carregando fichas de cadastro...
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDTg80PDHFMG7hFMn8fh3dPW7oHYakvc-Q",
            authDomain: "rd-turbo-bot.firebaseapp.com",
            projectId: "rd-turbo-bot",
            storageBucket: "rd-turbo-bot.firebasestorage.app",
            messagingSenderId: "681502711638",
            appId: "1:681502711638:web:0b43afb70cae48bd1dc0f7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        db.collection('usuarios').orderBy('data', 'desc').onSnapshot(snap => {
            const container = document.getElementById('lista-clientes');
            container.innerHTML = '';
            snap.forEach(doc => {
                const u = doc.data();
                const statusTxt = u.status === 'liberado' ? 'LIBERADO' : 'PENDENTE';
                const statusCor = u.status === 'liberado' ? 'text-green-500' : 'text-yellow-500';
                
                container.innerHTML += `
                    <div class="p-4 bg-slate-800 rounded-xl border border-gray-700 mb-2">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="text-yellow-500 font-black uppercase">${u.nome || 'Sem Nome'}</p>
                                <p class="text-[10px] text-gray-300">Zap: ${u.whatsapp || '---'} | Email: ${u.email}</p>
                                <p class="text-[10px] font-bold ${statusCor} mt-1">${statusTxt}</p>
                            </div>
                            <button onclick="excluirUser('${doc.id}')" class="text-red-500 text-xs font-bold">EXCLUIR</button>
                        </div>
                        <div class="flex gap-2 mt-3">
                            <button onclick="mudarStatus('${doc.id}', 'liberado')" class="flex-1 bg-green-600 text-[10px] font-black py-2 rounded-md uppercase">Liberar</button>
                            <button onclick="editarUser('${doc.id}', '${u.nome}', '${u.whatsapp}')" class="flex-1 bg-blue-600 text-[10px] font-black py-2 rounded-md uppercase">Editar</button>
                        </div>
                    </div>`;
            });
        });

        function mudarStatus(id, s) {
            db.collection('usuarios').doc(id).update({ status: s }).then(() => alert("Status Atualizado!"));
        }

        function excluirUser(id) {
            if(confirm("Deseja realmente excluir este cliente?")) {
                db.collection('usuarios').doc(id).delete();
            }
        }

        function editarUser(id, nomeAtual, zapAtual) {
            const novoNome = prompt("Novo Nome:", nomeAtual);
            const novoZap = prompt("Novo WhatsApp:", zapAtual);
            if(novoNome && novoZap) {
                db.collection('usuarios').doc(id).update({ nome: novoNome, whatsapp: novoZap })
                .then(() => alert("Dados Atualizados!"));
            }
        }

        function salvarConfig() {
            const link = document.getElementById('link_robo').value;
            const token = document.getElementById('tg_token').value;
            const chatid = document.getElementById('tg_chat_id').value;
            db.collection('config').doc('geral').set({ 
                link_afiliado: link, 
                telegram_token: token, 
                telegram_chatid: chatid 
            }, { merge: true }).then(() => alert("Configurações Salvas!"));
        }
    </script>
</body>
</html>
